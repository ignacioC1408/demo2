<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Productos - Punto F√°cil</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f7fafc; font-family: 'Segoe UI', sans-serif; }
        .navbar { background: linear-gradient(90deg, #2980b9, #6dd5fa); }
        .navbar-brand, .nav-link, .text-white { color: white !important; }
        .card { border-radius: 12px; box-shadow: 0px 3px 12px rgba(0,0,0,0.15); transition: transform 0.3s; }
        .card:hover { transform: scale(1.03); }
        .price { color: #007bff; font-weight: bold; }
        .btn-primary { background-color: #007bff; border: none; }
        .btn-primary:hover { background-color: #0056b3; }

        /* Ofertas */
        .oferta-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #e53935;
            color: #fff;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg px-4">
    <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="/images/logo.png" alt="Logo" width="40" class="me-2">
        <span>Punto F√°cil</span>
    </a>
    <div class="ms-auto d-flex align-items-center">
        <span class="text-white me-3" th:text="'Hola, ' + ${usuario.nombre}"></span>
        <a th:href="@{/usuario/carrito/ver}" class="btn btn-light btn-sm me-2">üõçÔ∏è Ver carrito</a>
        <a th:href="@{/logout}" class="btn btn-outline-light btn-sm">Cerrar sesi√≥n</a>
    </div>
</nav>

<div class="container py-5">
    <h2 class="text-center mb-4">Productos disponibles</h2>

    <!-- üî• SECCI√ìN DE OFERTAS (solo si hay ofertas vigentes) -->
    <div th:if="${ofertas != null and !ofertas.isEmpty()}" class="mb-5">
        <h4 class="mb-3">üî• Ofertas del d√≠a</h4>
        <div class="row g-3">
            <div class="col-md-4" th:each="o : ${ofertas}">
                <div class="card border-success h-100 position-relative">

                    <!-- Badge de % de descuento -->
                    <div class="oferta-badge"
                         th:text="${o.porcentaje + '% OFF'}">
                        10% OFF
                    </div>

                    <!-- Imagen de la oferta -->
                    <img th:if="${o.imagen != null}"
                         th:src="@{'/uploads/' + ${o.imagen}}"
                         class="card-img-top"
                         alt="Imagen oferta"
                         style="height: 160px; object-fit: cover;">
                    <img th:if="${o.imagen == null}"
                         src="/images/default.png"
                         class="card-img-top"
                         alt="Oferta"
                         style="height: 160px; object-fit: cover;">

                    <div class="card-body">
                        <h5 class="card-title" th:text="${o.titulo}">T√≠tulo oferta</h5>

                        <p class="mb-1">
                            <strong>Producto:</strong>
                            <span th:text="${o.producto != null ? o.producto.nombre : 'N/D'}">Producto</span>
                        </p>

                        <!-- precios -->
                        <p class="mb-1">
                            <span class="text-muted text-decoration-line-through"
                                  th:text="${o.producto != null ? '$' + o.producto.precioBase : ''}">
                                $0.00
                            </span>
                        </p>
                        <p class="mb-1">
                            <strong>Precio oferta:</strong>
                            <span class="text-success fw-bold"
                                  th:text="${'$' + o.precioOferta}">
                                $0.00
                            </span>
                        </p>

                        <!-- Fechas de la oferta: USAMOS #temporals EN VEZ DE #dates -->
                        <p class="small text-muted"
                           th:if="${o.fechaInicio != null and o.fechaFin != null}">
                            <span th:text="${#temporals.format(o.fechaInicio,'dd/MM/yyyy')}"></span>
                            <span> al </span>
                            <span th:text="${#temporals.format(o.fechaFin,'dd/MM/yyyy')}"></span>
                        </p>

                        <p class="small text-muted"
                           th:if="${o.fechaInicio != null and o.fechaFin == null}">
                            <span>Desde </span>
                            <span th:text="${#temporals.format(o.fechaInicio,'dd/MM/yyyy')}"></span>
                        </p>

                        <p class="small text-muted"
                           th:if="${o.fechaInicio == null and o.fechaFin != null}">
                            <span>Hasta </span>
                            <span th:text="${#temporals.format(o.fechaFin,'dd/MM/yyyy')}"></span>
                        </p>

                        <p class="small" th:if="${o.descripcion != null}" th:text="${o.descripcion}">
                            Descripci√≥n de la oferta
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- üî• FIN SECCI√ìN OFERTAS -->

    <!-- üõí GRID DE PRODUCTOS -->
    <div class="row g-4">
        <div class="col-md-4" th:each="p : ${productos}">
            <div class="card h-100 text-center">

                <!-- Imagen del producto -->
                <img th:if="${p.imagen != null}"
                     th:src="@{'/uploads/' + ${p.imagen}}"
                     class="card-img-top"
                     th:alt="${p.nombre}"
                     style="height: 180px; object-fit: cover;">

                <img th:if="${p.imagen == null}"
                     src="/images/default.png"
                     class="card-img-top"
                     alt="Producto"
                     style="height: 180px; object-fit: cover;">

                <div class="card-body">
                    <h5 th:text="${p.nombre}">Nombre</h5>
                    <p>
                        <strong>C√≥digo:</strong>
                        <span th:text="${p.codigoProducto}"></span>
                    </p>
                    <p>
                        <strong>Stock:</strong>
                        <span th:text="${p.stock}"></span>
                        <span th:text="${p.unidadMedida}"></span>
                    </p>
                    <p class="price" th:text="'$' + ${p.precioBase}">$0.00</p>

                    <form th:action="@{/usuario/carrito/agregar}" method="post">
                        <input type="hidden" name="idProducto" th:value="${p.id}">
                        <button type="submit" class="btn btn-primary">Agregar al carrito</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- üõí FIN GRID PRODUCTOS -->
</div>
</body>
</html>

